<?php
	require_once( $_SERVER['DOCUMENT_ROOT'].'/Index_system/Helpers/DocxConversion.php' );
	require_once( $_SERVER['DOCUMENT_ROOT'].'/Index_system/Helpers/GlobalSolrBars.php' );

	if ( 0 < $_FILES['file']['error'] ) {
           echo 'Error: ' . $_FILES['file']['error'] . '<br>';
    	} else {
	   
		move_uploaded_file($_FILES['file']['tmp_name'], '/var/www/uploads/' . $_FILES['file']['name']);
  	        $docObj = new DocxConversion( '/var/www/uploads/'.$_FILES['file']['name'] );
	    	$docText = $docObj->convertToText( );
	    
		$options = array
		(
			'hostname' => SOLR_SERVER_HOSTNAME,
    			'login'    => SOLR_SERVER_USERNAME,
    			'password' => SOLR_SERVER_PASSWORD,
    			'port'     => SOLR_SERVER_PORT,
		);

		$client = new SolrClient($options);

		$doc = new SolrInputDocument();

		$doc->addField('cat', 'Cartas');
		$doc->addField('studentid', $_POST['studentid'] );
		$doc->addField('name', $_FILES['file']['name']);
		$doc->addField('description', '/var/www/uploads/'.$_FILES['file']['name'] );
		$doc->addField('date', date('m').'/'.date('d').'/'.date('Y') );
		$doc->addField('time', date( 'h:i A' ) );
		$doc->addField('content_text', $docText );
		
		$updateResponse = $client->addDocument($doc);

		// you will have to commit changes to be written if you didn't use $commitWithin
       	    	$client->commit();

		print_r($updateResponse->getResponse());

	    
	}
?>